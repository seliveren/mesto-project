(()=>{"use strict";var e=document.querySelectorAll(".popup"),t=document.querySelector(".popup_type_for-profile"),n=document.querySelector(".popup_type_for-place"),o=document.querySelector(".popup_type_for-photo"),r=document.querySelector(".popup_type_for-avatar"),c=document.querySelector(".button_category_edit"),a=document.querySelector(".button_category_add"),u=(document.querySelector(".button_category_save"),document.querySelectorAll(".button_category_save")),i=t.querySelector(".popup__form"),l=document.querySelector(".popup__item_type_name"),s=document.querySelector(".popup__item_type_about-info"),d=document.querySelector(".profile__name"),p=document.querySelector(".profile__about-info"),f=document.querySelectorAll(".popup__item"),_=document.querySelectorAll(".popup__error"),y=document.querySelector(".places"),m=document.querySelector("#card").content,v=n.querySelector(".popup__form"),h=document.querySelector(".popup__item_type_place-name"),S=document.querySelector(".popup__item_type_place-link"),b=document.querySelector(".popup__photo"),q=document.querySelector(".popup__caption"),L=document.querySelector(".profile__avatar"),g=document.querySelector(".popup__item_type_avatar-link"),E=r.querySelector(".popup__form"),k=document.querySelector(".profile__avatar-overlay");function C(e){e.classList.add("popup_opened"),document.addEventListener("keydown",A)}function x(e){e.classList.remove("popup_opened"),document.removeEventListener("keydown",A)}function A(t){"Escape"===t.key&&e.forEach((function(e){e.classList.contains("popup_opened")&&x(e)}))}function U(e,t,n,r,c,a,u,i,l,s,d){var p=m.querySelector(".places__place").cloneNode(!0),f=p.querySelector(".places__image");if(f.src=t,p.querySelector(".places__name").textContent=e,f.alt=n,p.querySelector(".like-counter").textContent=u,p.setAttribute("data-id","".concat(r)),u>=0)for(var _=0;_<u;_++)a[_]._id===d&&p.querySelector(".button_category_like").classList.add("button_category_like-active");return c!==d&&p.querySelector(".button_category_delete").remove(),c===d&&p.querySelector(".button_category_delete").addEventListener("click",(function(e){var t=e.target.closest(".places__place").dataset.id;i(t),e.target.closest(".places__place").remove()})),p.querySelector(".button_category_like").addEventListener("click",(function(e){var t=e.target.closest(".places__place").dataset.id;p.querySelector(".button_category_like").classList.contains("button_category_like-active")?(s(t),p.querySelector(".button_category_like").classList.remove("button_category_like-active"),p.querySelector(".like-counter").textContent=u):(l(t),p.querySelector(".button_category_like").classList.add("button_category_like-active"),p.querySelector(".like-counter").textContent=u+1)})),f.addEventListener("click",(function(){return function(e,t,n){C(o),b.src=e,q.textContent=t,b.alt=n}(t,e,n)})),p}function T(e){u.forEach((function(t){t.textContent=e?"Сохранение...":"Сохранить"}))}function D(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.classList.remove(n.inactiveButtonClass),t.disabled=!1):(t.classList.add(n.inactiveButtonClass),t.disabled=!0)}var w,B,P,N={baseUrl:"https://mesto.nomoreparties.co/v1/plus-cohort-15",headers:{authorization:"050bcd5a-06bf-4407-a870-0360b5924952","Content-Type":"application/json"}},O=function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))};function j(e){L.src=e.avatar}function J(e){(function(e){return fetch("".concat(N.baseUrl,"/cards/").concat(e),{method:"DELETE",headers:N.headers}).then((function(e){return O(e)}))})(e).catch((function(e){console.log(e)}))}function H(e){(function(e){return fetch("".concat(N.baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:N.headers}).then((function(e){return O(e)}))})(e).catch((function(e){console.log(e)}))}function M(e){(function(e){return fetch("".concat(N.baseUrl,"/cards/likes/").concat(e),{method:"DELETE",headers:N.headers}).then((function(e){return O(e)}))})(e).catch((function(e){console.log(e)}))}c.addEventListener("click",(function(){C(t),l.value=d.textContent,s.value=p.textContent})),i.addEventListener("submit",(function(e){e.preventDefault(),T(!0);var n=s;(function(e){return fetch("".concat(N.baseUrl,"/users/me"),{method:"PATCH",headers:N.headers,body:JSON.stringify({name:e.name,about:e.about})}).then((function(e){return O(e)}))})({name:l.value,about:n.value}).then((function(e){d.textContent=e.name,p.textContent=e.about})).then((function(e){return x(t)})).catch((function(e){console.log(e)})).finally((function(e){T(!1)}))})),a.addEventListener("click",(function(){v.reset(),C(n)})),v.addEventListener("submit",(function(e){e.preventDefault(),T(!0);var t=S;(function(e){return fetch("".concat(N.baseUrl,"/cards"),{method:"POST",headers:N.headers,body:JSON.stringify({name:e.name,link:e.link})}).then((function(e){return O(e)}))})({name:h.value,link:t.value}).then((function(e){var t;t=U(e.name,e.link,e.alt,e._id,e.owner._id,e.likes,e.likes.length,J,H,M,P),y.prepend(t)})).then((function(e){return v.reset()})).then((function(e){x(n)})).catch((function(e){console.log(e)})).finally((function(e){T(!1)}))})),k.addEventListener("click",(function(){C(r),E.reset()})),E.addEventListener("submit",(function(e){e.preventDefault(),T(!0),function(e){return fetch("".concat(N.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:N.headers,body:JSON.stringify({avatar:e.avatar})}).then((function(e){return O(e)}))}({avatar:g.value}).then((function(e){j(e)})).then((function(e){return E.reset()})).then((function(e){x(r)})).catch((function(e){console.log(e)})).finally((function(e){T(!1)}))})),L.addEventListener("mouseover",(function(){k.classList.add("profile__avatar-overlay_displayed")})),k.addEventListener("mouseout",(function(){k.classList.remove("profile__avatar-overlay_displayed")})),w={formSelector:".popup__form",inputSelector:".popup__item",submitButtonSelector:".button_category_save",inactiveButtonClass:"button_inactive",inputErrorClass:"popup__item_type_error",errorClass:"popup__error_type_active"},(B=Array.from(document.querySelectorAll(w.formSelector))).forEach((function(e){e.addEventListener("submit",(function(e){e.preventDefault()})),B.forEach((function(e){!function(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.submitButtonSelector);D(n,o,t),e.addEventListener("reset",(function(){setTimeout((function(){D(n,o,t),function(e){f.forEach((function(t){t.classList.remove(e.inputErrorClass)})),_.forEach((function(t){t.classList.remove(e.errorClass)}))}(t)}),0)})),n.forEach((function(r){r.addEventListener("input",(function(){!function(e,t){t.validity.patternMismatch?t.setCustomValidity(t.dataset.error):t.setCustomValidity("")}(0,r),function(e,t,n){t.validity.valid?function(e,t,n){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(n.inputErrorClass),o.classList.remove(n.errorClass),o.textContent=""}(e,t,n):function(e,t,n,o){var r=e.querySelector(".".concat(t.id,"-error"));t.classList.add(o.inputErrorClass),r.textContent=n,r.classList.add(o.errorClass)}(e,t,t.validationMessage,n)}(e,r,t),D(n,o,t)}))}))}(e,w)}))})),e.forEach((function(e){e.addEventListener("mousedown",(function(t){(t.target.classList.contains("popup_opened")||t.target.classList.contains("button_category_close"))&&x(e)}))})),fetch("".concat(N.baseUrl,"/users/me"),{headers:N.headers}).then((function(e){return O(e)})).then((function(e){!function(e){d.textContent=e.name,p.textContent=e.about}(e),j(e),P=e._id,fetch("".concat(N.baseUrl,"/cards"),{headers:N.headers}).then((function(e){return O(e)})).then((function(e){!function(e){e.forEach((function(e){var t;t=U(e.name,e.link,e.alt,e._id,e.owner._id,e.likes,e.likes.length,J,H,M,P),y.append(t)}))}(e)})).catch((function(e){console.log(e)}))})).catch((function(e){console.log(e)}))})();