(()=>{"use strict";var e={d:(t,n)=>{for(var o in n)e.o(n,o)&&!e.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:n[o]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};e.d({},{gI:()=>I,Wq:()=>N,xQ:()=>Q,yJ:()=>z});var t=document.querySelectorAll(".popup"),n=document.querySelector(".popup_type_for-profile"),o=document.querySelector(".popup_type_for-place"),r=document.querySelector(".popup_type_for-photo"),c=document.querySelector(".popup_type_for-avatar"),a=document.querySelector(".button_category_edit"),u=document.querySelector(".button_category_add"),i=(document.querySelector(".button_category_save"),document.querySelectorAll(".button_category_save")),l=n.querySelector(".popup__form"),s=document.querySelector(".popup__item_type_name"),d=document.querySelector(".popup__item_type_about-info"),p=document.querySelector(".profile__name"),f=document.querySelector(".profile__about-info"),_=document.querySelectorAll(".popup__item"),y=document.querySelectorAll(".popup__error"),m=document.querySelector(".places"),v=document.querySelector("#card").content,h=o.querySelector(".popup__form"),b=document.querySelector(".popup__item_type_place-name"),S=document.querySelector(".popup__item_type_place-link"),q=document.querySelector(".popup__photo"),L=document.querySelector(".popup__caption"),g=document.querySelector(".profile__avatar"),E=document.querySelector(".popup__item_type_avatar-link"),k=c.querySelector(".popup__form"),C=document.querySelector(".profile__avatar-overlay");function x(e){e.classList.add("popup_opened"),document.addEventListener("keydown",U)}function A(e){e.classList.remove("popup_opened"),document.removeEventListener("keydown",U)}function U(e){"Escape"===e.key&&t.forEach((function(e){e.classList.contains("popup_opened")&&A(e)}))}function T(e,t,n,o,c,a,u){var i=v.querySelector(".places__place").cloneNode(!0),l=i.querySelector(".places__image");if(l.src=t,i.querySelector(".places__name").textContent=e,l.alt=n,i.querySelector(".like-counter").textContent=u,i.setAttribute("data-id","".concat(o)),u>=0)for(var s=0;s<u;s++)a[s]._id===N&&i.querySelector(".button_category_like").classList.add("button_category_like-active");return c!==N&&i.querySelector(".button_category_delete").remove(),c===N&&i.querySelector(".button_category_delete").addEventListener("click",(function(e){z(e.target.closest(".places__place").dataset.id),e.target.closest(".places__place").remove()})),i.querySelector(".button_category_like").addEventListener("click",(function(e){var t=e.target.closest(".places__place").dataset.id;i.querySelector(".button_category_like").classList.contains("button_category_like-active")?(Q(t),i.querySelector(".button_category_like").classList.remove("button_category_like-active"),i.querySelector(".like-counter").textContent=u):(I(t),i.querySelector(".button_category_like").classList.add("button_category_like-active"),i.querySelector(".like-counter").textContent=u+1)})),l.addEventListener("click",(function(){return function(e,t,n){x(r),q.src=e,L.textContent=t,q.alt=n}(t,e,n)})),i}function O(e){m.prepend(e)}function P(e){i.forEach((function(t){t.textContent=e?"Сохранение...":"Сохранить"}))}function D(){_.forEach((function(e){e.classList.remove("popup__item_type_error")})),y.forEach((function(e){e.classList.remove("popup__error_type_active")}))}function j(e,t){i.forEach((function(n){""===e.value||""===t.value?n.classList.add("button_inactive"):n.classList.remove("button_inactive")}))}function w(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.classList.remove(n.inactiveButtonClass),t.disabled=!1):(t.classList.add(n.inactiveButtonClass),t.disabled=!0)}var B,J,N,H={baseUrl:"https://mesto.nomoreparties.co/v1/plus-cohort-15",headers:{authorization:"050bcd5a-06bf-4407-a870-0360b5924952","Content-Type":"application/json"}},M=function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))},V=function(){return fetch("".concat(H.baseUrl,"/users/me"),{headers:H.headers}).then((function(e){return M(e)}))};function z(e){(function(e){return fetch("".concat(H.baseUrl,"/cards/").concat(e),{method:"DELETE",headers:H.headers}).then((function(e){return M(e)}))})(e).catch((function(e){console.log(e)}))}function I(e){(function(e){return fetch("".concat(H.baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:H.headers}).then((function(e){return M(e)}))})(e).catch((function(e){console.log(e)}))}function Q(e){(function(e){return fetch("".concat(H.baseUrl,"/cards/likes/").concat(e),{method:"DELETE",headers:H.headers}).then((function(e){return M(e)}))})(e).catch((function(e){console.log(e)}))}a.addEventListener("click",(function(){x(n),V().then((function(e){s.value=e.name,d.value=e.about})).catch((function(e){console.log(e)})),D(),j(s,d)})),l.addEventListener("submit",(function(e){e.preventDefault(),P(!0);var t=d;(function(e){return fetch("".concat(H.baseUrl,"/users/me"),{method:"PATCH",headers:H.headers,body:JSON.stringify({name:e.name,about:e.about})}).then((function(e){return M(e)}))})({name:s.value,about:t.value}).then((function(e){p.textContent=e.name,f.textContent=e.about})).then((function(e){return A(n)})).catch((function(e){console.log(e)})).finally((function(e){P(!1)}))})),u.addEventListener("click",(function(){x(o),S.value="",b.value="",D(),j(b,S)})),h.addEventListener("submit",(function(e){e.preventDefault(),P(!0);var t=S;(function(e){return fetch("".concat(H.baseUrl,"/cards"),{method:"POST",headers:H.headers,body:JSON.stringify({name:e.name,link:e.link})}).then((function(e){return M(e)}))})({name:b.value,link:t.value}).then((function(e){O(T(e.name,e.link))})).then((function(e){return h.reset()})).then((function(e){A(o)})).catch((function(e){console.log(e)})).finally((function(e){P(!1)}))})),C.addEventListener("click",(function(){x(c),E.value="",D(),j(E)})),k.addEventListener("submit",(function(e){e.preventDefault(),P(!0),function(e){return fetch("".concat(H.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:H.headers,body:JSON.stringify({avatar:e.avatar})}).then((function(e){return M(e)}))}({avatar:E.value}).then((function(e){g.src=e.avatar})).then((function(e){return k.reset()})).then((function(e){A(c)})).catch((function(e){console.log(e)})).finally((function(e){P(!1)}))})),g.addEventListener("mouseover",(function(){C.classList.add("profile__avatar-overlay_displayed")})),C.addEventListener("mouseout",(function(){C.classList.remove("profile__avatar-overlay_displayed")})),B={formSelector:".popup__form",inputSelector:".popup__item",submitButtonSelector:".button_category_save",inactiveButtonClass:"button_inactive",inputErrorClass:"popup__item_type_error",errorClass:"popup__error_type_active"},(J=Array.from(document.querySelectorAll(B.formSelector))).forEach((function(e){e.addEventListener("submit",(function(e){e.preventDefault()})),J.forEach((function(e){!function(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.submitButtonSelector);w(n,o,t),e.addEventListener("reset",(function(){setTimeout((function(){w(n,o,t)}),0)})),n.forEach((function(r){r.addEventListener("input",(function(){!function(e,t){t.validity.patternMismatch?t.setCustomValidity(t.dataset.error):t.setCustomValidity("")}(0,r),function(e,t,n){t.validity.valid?function(e,t,n){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(n.inputErrorClass),o.classList.remove(n.errorClass),o.textContent=""}(e,t,n):function(e,t,n,o){var r=e.querySelector(".".concat(t.id,"-error"));t.classList.add(o.inputErrorClass),r.textContent=n,r.classList.add(o.errorClass)}(e,t,t.validationMessage,n)}(e,r,t),w(n,o,t)}))}))}(e,B)}))})),t.forEach((function(e){e.addEventListener("mousedown",(function(t){t.target.classList.contains("popup_opened")&&A(e),t.target.classList.contains("button_category_close")&&A(e)}))})),V().then((function(e){!function(e){p.textContent=e.name,f.textContent=e.about}(e),function(e){g.src=e.avatar}(e),fetch("".concat(H.baseUrl,"/cards"),{headers:H.headers}).then((function(e){return M(e)})).then((function(e){!function(e){e.forEach((function(e){O(T(e.name,e.link,e.alt,e._id,e.owner._id,e.likes,e.likes.length))}))}(e)})).catch((function(e){console.log(e)}))})).catch((function(e){console.log(e)})),V().then((function(e){return N=e._id})).then((function(){return N}))})();