(()=>{"use strict";var e=document.querySelectorAll(".popup"),t=document.querySelector(".popup_type_for-profile"),n=document.querySelector(".popup_type_for-place"),o=document.querySelector(".popup_type_for-photo"),c=document.querySelector(".popup_type_for-avatar"),r=document.querySelector(".button_category_edit"),a=document.querySelector(".button_category_add"),u=t.querySelector(".popup__form"),i=document.querySelector(".popup__item_type_name"),s=document.querySelector(".popup__item_type_about-info"),l=document.querySelector(".profile__name"),d=document.querySelector(".profile__about-info"),p=document.querySelector(".places"),f=document.querySelector("#card").content,_=n.querySelector(".popup__form"),m=document.querySelector(".popup__item_type_place-name"),y=document.querySelector(".popup__item_type_place-link"),v=document.querySelector(".popup__photo"),h=document.querySelector(".popup__caption"),b=document.querySelector(".profile__avatar"),S=document.querySelector(".popup__item_type_avatar-link"),q=c.querySelector(".popup__form"),k=document.querySelector(".profile__avatar-overlay");function g(e){e.classList.add("popup_opened"),document.addEventListener("keydown",E)}function L(e){e.classList.remove("popup_opened"),document.removeEventListener("keydown",E)}function E(t){"Escape"===t.key&&e.forEach(L)}var C,j,x={baseUrl:"https://mesto.nomoreparties.co/v1/plus-cohort-15",headers:{authorization:"050bcd5a-06bf-4407-a870-0360b5924952","Content-Type":"application/json"}},P=function(){return fetch("".concat(x.baseUrl,"/users/me"),{headers:x.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))};function U(e,t){t.querySelector(".button_category_save").textContent=e?"Сохранение...":"Сохранить"}function A(e,t,n,c,r,a,u){var i=f.querySelector(".places__place").cloneNode(!0),s=i.querySelector(".places__image");s.src=t,i.querySelector(".places__name").textContent=e,s.alt=n,i.querySelector(".like-counter").textContent=u,i.setAttribute("data-id","".concat(c));var l=a.some((function(e){return"3c95ff7236bc20de41907267"===e._id}));return l&&i.querySelector(".button_category_like").classList.add("button_category_like-active"),"3c95ff7236bc20de41907267"===r&&('\n     <button class="button button_category_delete"></button>\n  ',i.insertAdjacentHTML("afterbegin",'\n     <button class="button button_category_delete"></button>\n  '),i.querySelector(".button_category_delete").addEventListener("click",(function(e){(function(e){(function(e){return fetch("".concat(x.baseUrl,"/cards/").concat(e),{method:"DELETE",headers:x.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))})(e).catch((function(e){console.log(e)}))})(e.target.closest(".places__place").dataset.id),e.target.closest(".places__place").remove()}))),i.querySelector(".button_category_like").addEventListener("click",(function(e){var t=e.target.closest(".places__place").dataset.id;i.querySelector(".button_category_like").classList.contains("button_category_like-active")||l?(function(e){(function(e){return fetch("".concat(x.baseUrl,"/cards/likes/").concat(e),{method:"DELETE",headers:x.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))})(e).catch((function(e){console.log(e)}))}(t),i.querySelector(".button_category_like").classList.remove("button_category_like-active"),i.querySelector(".like-counter").textContent=u):(function(e){(function(e){return fetch("".concat(x.baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:x.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))})(e).catch((function(e){console.log(e)}))}(t),i.querySelector(".button_category_like").classList.add("button_category_like-active"),i.querySelector(".like-counter").textContent=u+1)})),s.addEventListener("click",(function(){return function(e,t,n){g(o),v.src=e,h.textContent=t,v.alt=n}(t,e,n)})),i}function T(e){p.append(e)}function D(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.classList.remove(n.inactiveButtonClass),t.disabled=!1):(t.classList.add(n.inactiveButtonClass),t.disabled=!0)}P().then((function(e){l.textContent=e.name,d.textContent=e.about,b.src=e.avatar})).catch((function(e){console.log(e)})),fetch("".concat(x.baseUrl,"/cards"),{headers:x.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){e.forEach((function(e){T(A(e.name,e.link,e.alt,e._id,e.owner._id,e.likes,e.likes.length))}))})).catch((function(e){console.log(e)})),r.addEventListener("click",(function(){g(t),P().then((function(e){i.value=e.name,s.value=e.about})).catch((function(e){console.log(e)}))})),u.addEventListener("submit",(function(e){e.preventDefault(),U(!0,u);var n=s;(function(e){return fetch("".concat(x.baseUrl,"/users/me"),{method:"PATCH",headers:x.headers,body:JSON.stringify({name:e.name,about:e.about})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))})({name:i.value,about:n.value}).then((function(e){l.textContent=e.name,d.textContent=e.about})).catch((function(e){console.log(e)})).finally((function(e){U(!1,u)})),L(t)})),a.addEventListener("click",(function(){g(n)})),_.addEventListener("submit",(function(e){e.preventDefault(),U(!0,_);var t=y;(function(e){return fetch("".concat(x.baseUrl,"/cards"),{method:"POST",headers:x.headers,body:JSON.stringify({name:e.name,link:e.link})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))})({name:m.value,link:t.value}).then((function(e){T(A(e.name,e.link))})).catch((function(e){console.log(e)})).finally((function(e){U(!1,_)})),_.reset(),L(n)})),k.addEventListener("click",(function(){g(c)})),q.addEventListener("submit",(function(e){e.preventDefault(),U(!0,q),function(e){return fetch("".concat(x.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:x.headers,body:JSON.stringify({avatar:e.avatar})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))}({avatar:S.value}).then((function(e){b.src=e.avatar})).catch((function(e){console.log(e)})).finally((function(e){U(!1,q)})),q.reset(),L(c)})),b.addEventListener("mouseover",(function(){k.classList.add("profile__avatar-overlay_displayed")})),k.addEventListener("mouseout",(function(){k.classList.remove("profile__avatar-overlay_displayed")})),C={formSelector:".popup__form",inputSelector:".popup__item",submitButtonSelector:".button_category_save",inactiveButtonClass:"button_inactive",inputErrorClass:"popup__item_type_error",errorClass:"popup__error_type_active"},(j=Array.from(document.querySelectorAll(C.formSelector))).forEach((function(e){e.addEventListener("submit",(function(e){e.preventDefault()})),j.forEach((function(e){!function(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.submitButtonSelector);D(n,o,t),e.addEventListener("reset",(function(){setTimeout((function(){D(n,o,t)}),0)})),n.forEach((function(c){c.addEventListener("input",(function(){!function(e,t){t.validity.patternMismatch?t.setCustomValidity(t.dataset.error):t.setCustomValidity("")}(0,c),function(e,t,n){t.validity.valid?function(e,t,n){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(n.inputErrorClass),o.classList.remove(n.errorClass),o.textContent=""}(e,t,n):function(e,t,n,o){var c=e.querySelector(".".concat(t.id,"-error"));t.classList.add(o.inputErrorClass),c.textContent=n,c.classList.add(o.errorClass)}(e,t,t.validationMessage,n)}(e,c,t),D(n,o,t)}))}))}(e,C)}))})),e.forEach((function(e){e.addEventListener("mousedown",(function(t){t.target.classList.contains("popup_opened")&&L(e),t.target.classList.contains("button_category_close")&&L(e)}))}))})();